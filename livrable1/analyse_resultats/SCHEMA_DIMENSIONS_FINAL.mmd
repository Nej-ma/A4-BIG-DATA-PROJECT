erDiagram
    %% ============================================================
    %% SCHEMA DIMENSIONNEL FINAL CHU - CONSTELLATION D'ETOILES
    %% Verifie avec les sources reelles (PostgreSQL + CSV + XLSX)
    %% Date: 2025-10-13
    %% ============================================================

    %% ===== DIMENSIONS COMMUNES =====

    DIM_TEMPS {
        int sk_temps PK "Cle surrogate"
        date date_complete "Date complete YYYY-MM-DD"
        int annee "Annee 2014-2025"
        int trimestre "Trimestre 1-4"
        int mois "Mois 1-12"
        varchar mois_libelle "Janvier-Decembre"
        int semaine "Semaine ISO 1-53"
        int jour "Jour du mois 1-31"
        varchar jour_semaine "Lundi-Dimanche"
        int jour_semaine_num "1=Lundi 7=Dimanche"
        boolean est_weekend "0/1"
        boolean est_ferie "0/1"
        varchar trimestre_libelle "Q1-Q4"
    }

    DIM_PATIENT {
        int sk_patient PK "Cle surrogate"
        varchar patient_pseudo_id "SHA-256 pseudonymise"
        char sexe "M/F - SOURCE PG: Sexe"
        int age "Age - SOURCE PG: Age"
        varchar tranche_age "0-18 19-65 65+"
        varchar groupe_sanguin "A B AB O - SOURCE PG: Groupe_sanguin"
        varchar ville "Ville - SOURCE PG: Ville"
        varchar code_postal "CODE5 - SOURCE PG: Code_postal"
        varchar pays "Pays - SOURCE PG: Pays"
        decimal poid "kg - SOURCE PG: Poid"
        decimal taille "cm - SOURCE PG: Taille"
        decimal bmi "CALCULE poid/(taille/100)^2"
    }

    DIM_DIAGNOSTIC {
        int sk_diagnostic PK "Cle surrogate"
        varchar code_diag "Code CIM-10 - SOURCE PG: Code_diag"
        varchar libelle_diagnostic "Description - SOURCE PG: Diagnostic"
        varchar code_cim10_3car "3 car EXTRAIT"
        varchar chapitre_cim10 "Chapitre CIM-10 OMS"
        varchar categorie_cim10 "Categorie CIM-10 OMS"
        varchar gravite "Benin Modere Severe Critique"
    }

    DIM_ETABLISSEMENT {
        int sk_etablissement PK "Cle surrogate"
        varchar finess "FINESS - SOURCE CSV: finess_site"
        varchar identifiant_organisation "SOURCE CSV: identifiant_organisation"
        varchar nom_etablissement "SOURCE CSV: raison_sociale_site"
        varchar enseigne_commerciale "SOURCE CSV: enseigne_commerciale_site"
        varchar commune "SOURCE CSV: commune"
        varchar code_postal "SOURCE CSV: code_postal"
        varchar code_commune "SOURCE CSV: code_commune"
        varchar adresse "SOURCE CSV: adresse"
        varchar voie "SOURCE CSV: voie"
        varchar type_voie "SOURCE CSV: type_voie"
        varchar numero_voie "SOURCE CSV: numero_voie"
        varchar cedex "SOURCE CSV: cedex"
        varchar pays "SOURCE CSV: pays"
        varchar telephone "SOURCE CSV: telephone"
        varchar telephone_2 "SOURCE CSV: telephone_2"
        varchar telecopie "SOURCE CSV: telecopie"
        varchar email "SOURCE CSV: email"
        varchar siren "SOURCE CSV: siren_site"
        varchar siret "SOURCE CSV: siret_site"
        varchar finess_etablissement_juridique "SOURCE CSV: finess_etablissement_juridique"
        varchar region "CALCULE depuis code_postal"
    }

    %% ===== DIMENSIONS SPECIFIQUES =====

    DIM_PROFESSIONNEL {
        int sk_professionnel PK "Cle surrogate"
        varchar prof_pseudo_id "SHA-256 pseudonymise"
        varchar civilite "M Mme - SOURCE PG: Civilite"
        varchar categorie_professionnelle "Civil - SOURCE PG: Categorie_professionnelle"
        varchar profession "SOURCE PG/CSV: Profession"
        varchar type_identifiant "ADELI RPPS - SOURCE PG/CSV: Type_identifiant"
        varchar specialite "SOURCE CSV: specialite"
        varchar commune "SOURCE CSV: commune"
        varchar code_specialite "SOURCE PG: Code_specialite FK"
    }

    DIM_SPECIALITE {
        int sk_specialite PK "Cle surrogate"
        varchar code_specialite "SOURCE PG: Code_specialite"
        varchar fonction "SOURCE PG: Fonction"
        varchar specialite "SOURCE PG: Specialite"
        varchar domaine_medical "Chirurgie Medecine CALCULE"
    }

    DIM_MUTUELLE {
        int sk_mutuelle PK "Cle surrogate"
        varchar id_mut "SOURCE PG: Id_Mut"
        varchar nom "SOURCE PG: Nom"
        varchar adresse "SOURCE PG: Adresse"
        varchar type_mutuelle "Nationale Regionale CALCULE"
        varchar region_mutuelle "CALCULE depuis Adresse"
    }

    DIM_TYPE_ENQUETE {
        int sk_type_enquete PK "Cle surrogate"
        varchar type_enquete "ESATIS48H ESATISCA"
        int annee_enquete "2020"
        varchar libelle_court "E-Satis 48h MCO"
        varchar libelle_complet "Description complete"
        varchar methodologie "Questionnaire post-sortie"
        varchar periodicite "Annuelle"
        varchar secteur "MCO MCO-CA"
        text description "Description detaillee"
    }

    %% ===== TABLES DE FAITS =====

    FAIT_CONSULTATION {
        int sk_temps FK "-> DIM_TEMPS"
        int sk_patient FK "-> DIM_PATIENT"
        int sk_professionnel FK "-> DIM_PROFESSIONNEL"
        int sk_diagnostic FK "-> DIM_DIAGNOSTIC"
        int sk_etablissement FK "-> DIM_ETABLISSEMENT"
        int sk_mutuelle FK "-> DIM_MUTUELLE"
        int nb_consultations "Compteur =1"
        int duree_consultation "Minutes"
        decimal cout_consultation "Euros"
        varchar motif_consultation "Urgence Controle"
    }

    FAIT_HOSPITALISATION {
        int sk_temps_entree FK "-> DIM_TEMPS entree"
        int sk_temps_sortie FK "-> DIM_TEMPS sortie"
        int sk_patient FK "-> DIM_PATIENT"
        int sk_etablissement FK "-> DIM_ETABLISSEMENT"
        int sk_diagnostic FK "-> DIM_DIAGNOSTIC"
        int nb_hospitalisations "Compteur =1"
        int duree_sejour "Jours - SOURCE CSV: Jour_Hospitalisation"
        decimal cout_sejour "Euros"
        varchar service "Cardiologie Chirurgie"
        varchar mode_entree "Urgence Programme"
        varchar mode_sortie "Domicile Transfert Deces"
    }

    FAIT_DECES {
        int sk_temps FK "-> DIM_TEMPS date_deces"
        int sk_patient FK "-> DIM_PATIENT"
        int nb_deces "Compteur =1"
        int age_au_deces "CALCULE"
        varchar numero_acte_deces "SOURCE CSV: numero_acte_deces"
        varchar code_lieu_naissance "SOURCE CSV: code_lieu_naissance"
        varchar lieu_naissance "SOURCE CSV: lieu_naissance"
        varchar pays_naissance "SOURCE CSV: pays_naissance"
        varchar code_lieu_deces "SOURCE CSV: code_lieu_deces"
    }

    FAIT_SATISFACTION_PATIENT {
        int sk_temps FK "-> DIM_TEMPS 2020"
        int sk_etablissement FK "-> DIM_ETABLISSEMENT"
        int sk_type_enquete FK "-> DIM_TYPE_ENQUETE"
        int nb_reponses "SOURCE XLSX: nb_rep_score_all_rea_ajust"
        decimal score_global "SOURCE XLSX: score_all_rea_ajust"
        decimal score_accueil "SOURCE XLSX: score_accueil_rea_ajust"
        decimal score_pec_infirmiere "SOURCE XLSX: score_PECinf_rea_ajust"
        decimal score_pec_medicale "SOURCE XLSX: score_PECmed_rea_ajust"
        decimal score_chambre "SOURCE XLSX: score_chambre_rea_ajust"
        decimal score_repas "SOURCE XLSX: score_repas_rea_ajust"
        decimal score_sortie "SOURCE XLSX: score_sortie_rea_ajust"
        varchar classement "A B C NV DI - SOURCE XLSX: classement"
        varchar evolution "Amelioration Stable - SOURCE XLSX: evolution"
    }

    %% ===== RELATIONS FAIT_CONSULTATION =====
    FAIT_CONSULTATION }o--|| DIM_TEMPS : "date_consultation"
    FAIT_CONSULTATION }o--|| DIM_PATIENT : "patient_consulte"
    FAIT_CONSULTATION }o--|| DIM_PROFESSIONNEL : "praticien"
    FAIT_CONSULTATION }o--|| DIM_DIAGNOSTIC : "pathologie"
    FAIT_CONSULTATION }o--|| DIM_ETABLISSEMENT : "lieu_consultation"
    FAIT_CONSULTATION }o--|| DIM_MUTUELLE : "couverture_sociale"

    %% ===== RELATIONS FAIT_HOSPITALISATION =====
    FAIT_HOSPITALISATION }o--|| DIM_TEMPS : "date_entree"
    FAIT_HOSPITALISATION }o--|| DIM_TEMPS : "date_sortie"
    FAIT_HOSPITALISATION }o--|| DIM_PATIENT : "patient_hospitalise"
    FAIT_HOSPITALISATION }o--|| DIM_ETABLISSEMENT : "etablissement_accueil"
    FAIT_HOSPITALISATION }o--|| DIM_DIAGNOSTIC : "diagnostic_principal"

    %% ===== RELATIONS FAIT_DECES =====
    FAIT_DECES }o--|| DIM_TEMPS : "date_deces"
    FAIT_DECES }o--|| DIM_PATIENT : "patient_decede"

    %% ===== RELATIONS FAIT_SATISFACTION_PATIENT =====
    FAIT_SATISFACTION_PATIENT }o--|| DIM_TEMPS : "periode_enquete"
    FAIT_SATISFACTION_PATIENT }o--|| DIM_ETABLISSEMENT : "etablissement_evalue"
    FAIT_SATISFACTION_PATIENT }o--|| DIM_TYPE_ENQUETE : "type_enquete"

    %% ===== RELATIONS INTER-DIMENSIONS =====
    DIM_PROFESSIONNEL }o--|| DIM_SPECIALITE : "specialite_medicale"
